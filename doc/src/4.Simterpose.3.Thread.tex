\subsubsection{Les threads}
 %% syscall clone + libcalls

La gestion des threads se fera à deux niveaux dans Simterpose. On utilise l'interception d'appels système via \texttt{ptrace} pour tout ce qui concerne la création de threads (\texttt{fork}(), \texttt{clone}(), \texttt{pthread\_create}()). Pour le reste on doit utiliser un autre outil, car il existe des mécanismes utilisés par les threads qui ne passent pas par des appels systèmes pour s'exécuter, par exemple les futex\footnote{fast User-space mutex \\ \url{http://man7.org/linux/man-pages/man7/futex.7.html}}. On va donc utiliser le préchargement de bibliothèques dynamiques en complément. Comme nous l'avons vu en section \ref{paragraphe:LDPreload}, nous allons créer une librairie contenant toutes les fonctions utilisées par les threads que nous voulons intercepter (\texttt{pthread\_init}(), \texttt{pthread\_join}(), \texttt{pthread\_exit}(), \texttt{pthread\_yield}() ...). On placera ensuite la bibliothèque dans la variable d'environnement \texttt{LD\_PRELOAD} pour que nos fonctions passent avant les autres.


